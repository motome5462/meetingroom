<!DOCTYPE html>
<html>
<head>
  <title>แก้ไขการจองห้องประชุม</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body>
  <header class="mb-4">
    <% include index.ejs %> <!-- shared header/navigation -->
  </header>

  <div class="container mt-4">
    <h2 class="text-center mb-4">แก้ไขการจองห้องประชุม</h2>

    <form action="/admin/admindashboard/edit/<%= meeting._id %>" method="POST">
      <!-- Employee ID input (readonly or editable if you want) -->
      <div class="mb-3">
        <label>รหัสพนักงานผู้ขอใช้ห้องประชุม (Employee ID)</label>
        <input
          type="number"
          class="form-control"
          name="employeeid"
          value="<%= meeting.employeeId || '' %>"
          readonly
        >
      </div>

      <!-- Date input -->
      <div class="mb-3">
        <label>วันที่ต้องการใช้</label>
        <input
          type="date"
          class="form-control"
          name="date"
          value="<%= new Date(meeting.datetimein).toISOString().slice(0, 10) %>"
          required
        >
      </div>

      <!-- Time range inputs -->
      <div class="row mb-3">
        <div class="col">
          <label>เวลาตั้งแต่</label>
          <input
            type="time"
            class="form-control"
            name="timein"
            value="<%= new Date(meeting.datetimein).toISOString().slice(11, 16) %>"
            required
          >
        </div>
        <div class="col">
          <label>ถึง</label>
          <input
            type="time"
            class="form-control"
            name="timeout"
            value="<%= new Date(meeting.datetimeout).toISOString().slice(11, 16) %>"
            required
          >
        </div>
      </div>

      <!-- Room selection radio buttons -->
      <div class="mb-3">
        <label>เลือกห้อง</label><br/>
        <% ['ห้องประชุม 1', 'ห้องประชุม 2', 'ห้องประชุม 3'].forEach(roomOption => { %>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="room"
              value="<%= roomOption %>"
              id="room_<%= roomOption.replace(/\s/g, '') %>"
              required
              <%= meeting.room === roomOption ? 'checked' : '' %>
            >
            <label class="form-check-label" for="room_<%= roomOption.replace(/\s/g, '') %>"><%= roomOption %></label>
          </div>
        <% }) %>
      </div>

      <!-- Participants dynamic field -->
      <div id="participantFields">
        <% if (meeting.participants && meeting.participants.length) { %>
          <% meeting.participants.forEach(p => { %>
            <div class="input-group mb-2">
              <input
                type="number"
                class="form-control"
                name="participants[]"
                placeholder="รหัสพนักงาน"
                value="<%= p %>"
              >
              <button type="button" class="btn btn-outline-danger" onclick="removeParticipant(this.parentNode)">ลบ</button>
            </div>
          <% }) %>
        <% } else { %>
          <div class="input-group mb-2">
            <input type="number" class="form-control" name="participants[]" placeholder="รหัสพนักงาน">
            <button type="button" class="btn btn-outline-danger" onclick="removeParticipant(this.parentNode)">ลบ</button>
          </div>
        <% } %>
      </div>
      <button type="button" class="btn btn-primary btn-sm" onclick="addParticipant()">➕ เพิ่มผู้เข้าร่วม</button>

      <!-- Purpose dropdown and custom input -->
      <div class="mb-3">
        <label>วัตถุประสงค์</label>
        <select class="form-select" name="purpose" id="purposeSelect" onchange="toggleCustomPurpose()" required>
          <% 
            const purposes = [
              "ประชุมภายในองค์กร",
              "ประชุมระหว่างองค์กร กับ หน่วยงาน",
              "อบรม / สัมมนา",
              "อื่น ๆ"
            ];
            const selectedPurpose = purposes.includes(meeting.purpose) ? meeting.purpose : 'อื่น ๆ';
          %>
          <% purposes.forEach(p => { %>
            <option value="<%= p %>" <%= selectedPurpose === p ? 'selected' : '' %>><%= p %></option>
          <% }) %>
        </select>
<input
  type="text"
  class="form-control mt-2 <%= selectedPurpose === 'อื่น ๆ' ? '' : 'd-none' %>"
  name="customPurpose"
  id="customPurposeInput"
  placeholder="ระบุวัตถุประสงค์อื่น ๆ"
  value="<%= selectedPurpose === 'อื่น ๆ' ? meeting.purpose : '' %>"
/>
      </div>

      <!-- Equipment -->
      <div class="mb-3">
        <label>อุปกรณ์ที่ต้องการใช้</label>
        <input
          type="text"
          class="form-control"
          name="equipment"
          placeholder="เช่น โปรเจคเตอร์, ไมค์ ฯลฯ"
          value="<%= meeting.equipment || '' %>"
        >
      </div>

      <!-- Remark -->
      <div class="mb-3">
        <label>หมายเหตุเพิ่มเติม</label>
        <textarea class="form-control" name="remark" rows="3"><%= meeting.remark || '' %></textarea>
      </div>

      <!-- Submit -->
      <div class="d-flex justify-content-center">
        <button type="submit" class="btn btn-success px-4" style="margin-bottom: 25px;">บันทึกการแก้ไข</button>
        <a href="/admin/admindashboard" class="btn btn-secondary ms-3 align-self-center">ยกเลิก</a>
      </div>
    </form>
  </div>

  <!-- Use the same JS as insert.js -->
  <script src="/javascripts/insert.js"></script>
</body>
</html>
